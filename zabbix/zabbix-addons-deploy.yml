---
- name: Deploy Zabbix-addons for Varnish stats
  hosts: wit-frontend
  remote_user: "{{ remote_user }}"

  tasks:
  - name: Application | Git pull the latest code
    git: repo=git@github.com:ScientiaMobile/{{ project }}.git
      dest={{ source_path }}/{{ project }}
      accept_hostkey=yes
      force=yes
      version={{version}}

  - name: Docker Build | building zabbix-addons image
    become: yes
    become_user: root
    command: chdir={{ app_path }}/varnish ./build.sh

  - name: Docker UP | starting zabbix-addons container
    become: yes
    become_user: root
    command: chdir={{ app_path }}/varnish sudo ./start.sh
 
